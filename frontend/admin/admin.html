<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel</title>

  <!-- React + Babel for single-file dev -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome (for previewing FA icons) -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <style>
    /* small style for chips */
    .chip {
      display:inline-flex;align-items:center;padding:0.25rem 0.5rem;border-radius:9999px;background:#f3f4f6;margin-right:0.35rem;margin-bottom:0.35rem;
    }
    .chip .x{margin-left:0.45rem;cursor:pointer}
    /* searchable dropdown list */
    .dropdown-list { max-height:220px; overflow:auto; }
    .icon-preview { width:28px;height:28px;display:inline-flex;align-items:center;justify-content:center;margin-right:0.6rem; }
  </style>
</head>

<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    /**
     * --- Configuration / curated lists ---
     * - iconOptions: a curated list that combines FontAwesome icon class strings and
     *   named identifiers for other icon sets (react-icons, devicons, etc.).
     *   For FontAwesome items we include className for preview. For others we include a label.
     *
     * - colorPresets: simple named colors for quick selection + color picker available.
     *
     * - gradientPresets: preset gradient class strings the frontend can use for display.
     *
     * - classPresets: groups of common Tailwind utility classes the user can pick.
     *
     * The UI stores selections as plain JSON fields (e.g., icon: { set: 'fa', value: 'fa-brands fa-react' })
     * so backend remains unaffected: we keep using your existing "item" shape with additional UI-friendly fields.
     */

    const iconOptions = [
      // FontAwesome examples (we can preview these directly)
      { id: 'fa-react', set: 'fa', label: 'React (FontAwesome)', className: 'fa-brands fa-react' },
      { id: 'fa-github', set: 'fa', label: 'GitHub (FontAwesome)', className: 'fa-brands fa-github' },
      { id: 'fa-node', set: 'fa', label: 'Node.js (FontAwesome)', className: 'fa-brands fa-node' },
      { id: 'fa-js', set: 'fa', label: 'JavaScript (FontAwesome)', className: 'fa-brands fa-js' },
      { id: 'fa-python', set: 'fa', label: 'Python (FontAwesome)', className: 'fa-brands fa-python' },
      { id: 'fa-html5', set: 'fa', label: 'HTML5 (FontAwesome)', className: 'fa-brands fa-html5' },
      { id: 'fa-css3', set: 'fa', label: 'CSS3 (FontAwesome)', className: 'fa-brands fa-css3' },
      { id: 'fa-angular', set: 'fa', label: 'Angular (FontAwesome)', className: 'fa-brands fa-angular' },
      { id: 'fa-android', set: 'fa', label: 'Android (FontAwesome)', className: 'fa-brands fa-android' },
      { id: 'fa-aws', set: 'fa', label: 'AWS (FontAwesome)', className: 'fa-brands fa-aws' },

      // React-icons style labels (not previewed as SVG here - show labeled badges)
      { id: 'si-react', set: 'react-icons/si', label: 'SiReact (react-icons/si)', className: null },
      { id: 'si-nextdotjs', set: 'react-icons/si', label: 'SiNextdotjs (react-icons/si)', className: null },
      { id: 'si-vuedotjs', set: 'react-icons/si', label: 'SiVueDotJs (react-icons/si)', className: null },
      { id: 'si-angular', set: 'react-icons/si', label: 'SiAngular (react-icons/si)', className: null },
      { id: 'si-docker', set: 'react-icons/si', label: 'SiDocker (react-icons/si)', className: null },
      { id: 'si-typescript', set: 'react-icons/si', label: 'SiTypescript (react-icons/si)', className: null },
      { id: 'si-javascript', set: 'react-icons/si', label: 'SiJavascript (react-icons/si)', className: null },
      { id: 'si-tailwindcss', set: 'react-icons/si', label: 'SiTailwindcss (react-icons/si)', className: null },

      // devicons / technology icons labels
      { id: 'devicon-react', set: 'devicon', label: 'React (devicon)', className: null },
      { id: 'devicon-nodejs', set: 'devicon', label: 'Node.js (devicon)', className: null },
      { id: 'devicon-mongodb', set: 'devicon', label: 'MongoDB (devicon)', className: null },

      // generic icons for UI
      { id: 'fa-briefcase', set: 'fa', label: 'Briefcase', className: 'fa-solid fa-briefcase' },
      { id: 'fa-award', set: 'fa', label: 'Award', className: 'fa-solid fa-award' },
      { id: 'fa-graduation', set: 'fa', label: 'Graduation Cap', className: 'fa-solid fa-graduation-cap' },
    ];

    const colorPresets = [
      { id: 'purple', label: 'Purple', value: '#7c3aed' },
      { id: 'blue', label: 'Blue', value: '#2563eb' },
      { id: 'indigo', label: 'Indigo', value: '#4f46e5' },
      { id: 'emerald', label: 'Emerald', value: '#10b981' },
      { id: 'rose', label: 'Rose', value: '#f43f5e' },
      { id: 'slate', label: 'Slate', value: '#64748b' },
    ];

    const gradientPresets = [
      { id: 'g-purple-to-blue', label: 'Purple → Blue', value: 'from-purple-500 to-blue-500' },
      { id: 'g-pink-to-purple', label: 'Pink → Purple', value: 'from-pink-500 to-purple-600' },
      { id: 'g-cyan-to-blue', label: 'Cyan → Blue', value: 'from-cyan-500 to-blue-500' },
      { id: 'g-emerald-to-teal', label: 'Emerald → Teal', value: 'from-emerald-400 to-teal-500' },
      { id: 'g-gray', label: 'Gray → Slate', value: 'from-gray-300 to-slate-400' },
    ];

    const classPresets = [
      { id: 'card-1', label: 'Rounded card with shadow', value: 'rounded-2xl shadow-md p-4' },
      { id: 'card-2', label: 'Bordered card', value: 'rounded-xl border p-4' },
      { id: 'badge-1', label: 'Small purple badge', value: 'px-2 py-1 rounded-full text-sm bg-purple-100 text-purple-700' },
      { id: 'text-highlight', label: 'Highlighted title', value: 'text-lg font-semibold text-purple-600' },
    ];

    const defaultTechSuggestions = [
      'React', 'Next.js', 'Node.js', 'Express', 'MongoDB', 'MySQL', 'TypeScript', 'JavaScript', 'Tailwind CSS',
      'Flutter', 'Dart', 'Python', 'Django', 'Java', 'Spring Boot', 'C++', 'GraphQL', 'Docker', 'Kubernetes'
    ];

    /******************************************************************
     * Reusable small UI components: SearchableSelect, IconSelect, ColorSelect,
     * MultiSelectChips, PresetSelect.
     *
     * These are implemented in plain React with accessible markup and minimal
     * styling using Tailwind.
     ******************************************************************/

    function SearchableSelect({ label, value, onChange, options = [], placeholder = 'Search...', display = (o) => o.label }) {
      const [open, setOpen] = useState(false);
      const [filter, setFilter] = useState('');
      const ref = useRef();

      useEffect(() => {
        function onDoc(e) {
          if (!ref.current?.contains(e.target)) setOpen(false);
        }
        document.addEventListener('click', onDoc);
        return () => document.removeEventListener('click', onDoc);
      }, []);

      const filtered = options.filter(o => display(o).toLowerCase().includes(filter.toLowerCase()));

      return (
        <div className="relative" ref={ref}>
          <label className="block text-sm font-medium text-gray-700 mb-2">{label}</label>
          <div className="flex">
            <input
              className="w-full px-3 py-2 border border-gray-300 rounded-l-md focus:ring-2 focus:ring-purple-500"
              placeholder={placeholder}
              value={value ? display(value) : filter}
              onFocus={() => { setOpen(true); setFilter(''); }}
              onChange={(e) => { setFilter(e.target.value); setOpen(true); }}
            />
            <button type="button" onClick={() => setOpen(s => !s)} className="px-3 border border-l-0 border-gray-300 rounded-r-md bg-white">
              <i className="fas fa-caret-down text-gray-600"></i>
            </button>
          </div>

          {open && (
            <div className="absolute z-40 left-0 right-0 mt-1 bg-white border border-gray-200 rounded-md shadow dropdown-list">
              <div className="p-2 border-b">
                <input className="w-full px-2 py-1 border border-gray-200 rounded" placeholder="Type to filter..." value={filter} onChange={e => setFilter(e.target.value)} />
              </div>
              <ul>
                {filtered.map(opt => (
                  <li key={opt.id} className="px-3 py-2 hover:bg-gray-50 cursor-pointer flex items-center" onClick={() => { onChange(opt); setOpen(false); }}>
                    <span className="mr-2">{display(opt)}</span>
                  </li>
                ))}
                {filtered.length === 0 && <li className="px-3 py-2 text-sm text-gray-500">No results</li>}
              </ul>
            </div>
          )}
        </div>
      );
    }

    function IconSelect({ label, value, onChange }) {
      const [open, setOpen] = useState(false);
      const [filter, setFilter] = useState('');
      const ref = useRef();

      useEffect(() => {
        function handle(e) {
          if (!ref.current?.contains(e.target)) setOpen(false);
        }
        document.addEventListener('click', handle);
        return () => document.removeEventListener('click', handle);
      }, []);

      const filtered = iconOptions.filter(i => i.label.toLowerCase().includes(filter.toLowerCase()));

      return (
        <div className="relative" ref={ref}>
          <label className="block text-sm font-medium text-gray-700 mb-2">{label}</label>
          <div className="flex items-center gap-2">
            <div className="flex items-center px-3 py-2 border border-gray-300 rounded-md bg-white w-full">
              <div className="flex items-center">
                <div className="icon-preview">
                  {value?.set === 'fa' && value?.className ? <i className={value.className} style={{ fontSize: 18 }}></i> :
                    value ? <span className="text-sm px-2 py-1 rounded bg-gray-100 text-gray-700">{value.set.split('/').pop()}</span> :
                      <i className="fas fa-question text-gray-400"></i>}
                </div>
                <div className="text-sm text-gray-700">{value ? value.label : 'Select an icon...'}</div>
              </div>
              <div className="ml-auto">
                <button className="px-2" onClick={() => { setOpen(s => !s); setFilter(''); }}>
                  <i className="fas fa-caret-down text-gray-600"></i>
                </button>
              </div>
            </div>
          </div>

          {open && (
            <div className="absolute z-50 left-0 right-0 mt-2 bg-white border border-gray-200 rounded-md shadow dropdown-list">
              <div className="p-2 border-b">
                <input className="w-full px-2 py-1 border border-gray-200 rounded" placeholder="Search icons (e.g., react, github)" value={filter} onChange={e => setFilter(e.target.value)} />
              </div>
              <ul>
                {filtered.map(opt => (
                  <li key={opt.id} className="px-3 py-2 hover:bg-gray-50 cursor-pointer flex items-center" onClick={() => { onChange(opt); setOpen(false); }}>
                    <span className="icon-preview">
                      {opt.set === 'fa' && opt.className ? <i className={opt.className} style={{ fontSize: 18 }}></i> : <span className="text-xs px-2 py-1 rounded bg-gray-100 text-gray-700">{opt.set.split('/').pop()}</span>}
                    </span>
                    <div>
                      <div className="text-sm">{opt.label}</div>
                      <div className="text-xs text-gray-500">{opt.set}{opt.className ? ` • ${opt.className}` : ''}</div>
                    </div>
                  </li>
                ))}
                {filtered.length === 0 && <li className="px-3 py-2 text-sm text-gray-500">No icons found</li>}
              </ul>
            </div>
          )}
        </div>
      );
    }

    function ColorSelect({ label, value, onChange }) {
      const [open, setOpen] = useState(false);
      const ref = useRef();
      useEffect(() => {
        function h(e) { if (!ref.current?.contains(e.target)) setOpen(false); }
        document.addEventListener('click', h); return () => document.removeEventListener('click', h);
      }, []);
      return (
        <div ref={ref}>
          <label className="block text-sm font-medium text-gray-700 mb-2">{label}</label>
          <div className="flex gap-2 items-center">
            <input type="color" className="w-12 h-10 p-0 border border-gray-300 rounded" value={value || '#7c3aed'} onChange={e => onChange(e.target.value)} />
            <div className="relative flex-1">
              <input className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500" placeholder="Hex or choose preset" value={value || ''} onChange={e => onChange(e.target.value)} />
            </div>
            <button className="px-3 py-2 border border-gray-300 rounded bg-white" onClick={() => setOpen(s => !s)}>
              <i className="fas fa-palette"></i>
            </button>
          </div>

          {open && (
            <div className="mt-2 bg-white border border-gray-200 rounded shadow p-3">
              <div className="grid grid-cols-3 gap-2">
                {colorPresets.map(p => (
                  <button key={p.id} className="flex items-center gap-2 px-2 py-2 rounded hover:bg-gray-50" onClick={() => { onChange(p.value); setOpen(false); }}>
                    <span style={{ width: 28, height: 28, borderRadius: 6, background: p.value, display: 'inline-block' }}></span>
                    <span className="text-sm">{p.label}</span>
                  </button>
                ))}
              </div>
            </div>
          )}
        </div>
      );
    }

    function PresetSelect({ label, value, onChange, options }) {
      return (
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">{label}</label>
          <select className="w-full px-3 py-2 border border-gray-300 rounded" value={value || ''} onChange={e => onChange(e.target.value)}>
            <option value=''>Select preset (optional)</option>
            {options.map(o => <option key={o.id} value={o.value}>{o.label}</option>)}
          </select>
        </div>
      );
    }

    function MultiSelectChips({ label, values = [], onChange, suggestions = [] }) {
      const [input, setInput] = useState('');
      const [filtered, setFiltered] = useState([]);
      useEffect(() => setFiltered(suggestions.filter(s => s.toLowerCase().includes(input.toLowerCase()) && !values.includes(s))), [input, values]);

      function addVal(v) {
        if (!v) return;
        if (!values.includes(v)) onChange([...values, v]);
        setInput('');
      }
      function removeVal(v) {
        onChange(values.filter(x => x !== v));
      }
      return (
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">{label}</label>
          <div className="border border-gray-300 rounded px-3 py-2">
            <div className="flex flex-wrap mb-2">
              {values.map(v => (
                <div key={v} className="chip">
                  <span className="text-sm">{v}</span>
                  <span className="x text-gray-500" onClick={() => removeVal(v)}>×</span>
                </div>
              ))}
            </div>
            <div className="flex gap-2">
              <input className="flex-1 px-2 py-1 border border-gray-200 rounded" placeholder="Add technology and press Enter" value={input} onChange={e => setInput(e.target.value)} onKeyDown={e => { if (e.key === 'Enter') { e.preventDefault(); addVal(input.trim()); } }} />
              <button className="px-3 py-1 bg-purple-600 text-white rounded" onClick={() => addVal(input.trim())}>Add</button>
            </div>

            {input && filtered.length > 0 && (
              <div className="mt-2 grid grid-cols-2 gap-2">
                {filtered.slice(0,6).map(s => <button key={s} className="text-sm px-2 py-1 bg-gray-100 rounded" onClick={() => addVal(s)}>{s}</button>)}
              </div>
            )}
          </div>
        </div>
      );
    }

    /******************************************************************
     * Admin panel implementation
     ******************************************************************/
    const API_BASE = 'https://ahtisham-portfolio-five.vercel.app/api';

    function AdminPanel() {
      const [activeTab, setActiveTab] = useState('profile');
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [password, setPassword] = useState('');
      const [loading, setLoading] = useState(false);
      const [data, setData] = useState({ profile: {}, skills: [], projects: [], experience: [], certificates: [] });
      const [editingItem, setEditingItem] = useState(null);
      const [showModal, setShowModal] = useState(false);

      useEffect(() => {
        const token = localStorage.getItem('adminToken');
        if (token) {
          setIsAuthenticated(true);
          fetchAllData();
        }
      }, []);

      async function login() {
        setLoading(true);
        try {
          const response = await fetch(`${API_BASE}/auth/login`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ password }) });
          if (response.ok) {
            const { token } = await response.json();
            localStorage.setItem('adminToken', token);
            setIsAuthenticated(true);
            fetchAllData();
          } else {
            alert('Invalid password');
          }
        } catch (e) {
          alert('Login failed');
        } finally { setLoading(false); }
      }

      function logout() {
        localStorage.removeItem('adminToken');
        setIsAuthenticated(false);
        setPassword('');
      }

      async function fetchAllData() {
        try {
          const [profileRes, skillsRes, projectsRes, experienceRes, certificatesRes] = await Promise.all([
            fetch(`${API_BASE}/profile`),
            fetch(`${API_BASE}/skills`),
            fetch(`${API_BASE}/projects`),
            fetch(`${API_BASE}/experience`),
            fetch(`${API_BASE}/certificates`)
          ]);
          setData({
            profile: await profileRes.json(),
            skills: await skillsRes.json(),
            projects: await projectsRes.json(),
            experience: await experienceRes.json(),
            certificates: await certificatesRes.json()
          });
        } catch (err) {
          console.error('Error loading data', err);
        }
      }

      // IMPORTANT: keep saveItem API calls identical to your original behavior
      async function saveItem(type, item) {
        const token = localStorage.getItem('adminToken');

        try {
          let response;
          if (type === 'profile') {
            // we still send FormData for profile (safe if backend expects multipart)
            const formData = new FormData();
            formData.append('data', JSON.stringify(item));
            // no profileImage appended (you asked to remove profile image)
            response = await fetch(`${API_BASE}/profile`, {
              method: 'PUT',
              headers: { 'Authorization': `Bearer ${token}` },
              body: formData
            });
          } else {
            const url = item._id ? `${API_BASE}/${type}/${item._id}` : `${API_BASE}/${type}`;
            response = await fetch(url, {
              method: item._id ? 'PUT' : 'POST',
              headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(item)
            });
          }

          if (response.ok) {
            await fetchAllData();
            setEditingItem(null);
            setShowModal(false);
            alert('Saved successfully!');
          } else {
            const text = await response.text();
            console.error('Save error:', text);
            alert('Save failed: ' + text);
          }
        } catch (err) {
          console.error('Save error', err);
          alert('Save failed: ' + err.message);
        }
      }

      async function deleteItem(type, id) {
        if (!confirm('Are you sure you want to delete this item?')) return;
        const token = localStorage.getItem('adminToken');
        try {
          const res = await fetch(`${API_BASE}/${type}/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${token}` }
          });
          if (res.ok) {
            await fetchAllData();
            alert('Deleted successfully!');
          } else alert('Delete failed');
        } catch (err) {
          alert('Delete failed');
        }
      }

      if (!isAuthenticated) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <div className="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
              <div className="text-center mb-6">
                <i className="fas fa-lock text-purple-600 text-4xl mb-4"></i>
                <h2 className="text-2xl font-bold">Admin Login</h2>
                <p className="text-gray-600">Enter your admin password</p>
              </div>
              <input type="password" placeholder="Password" value={password} onChange={e => setPassword(e.target.value)} onKeyDown={e => e.key === 'Enter' && login()} className="w-full px-3 py-2 border rounded mb-4" />
              <button onClick={login} disabled={!password || loading} className="w-full bg-purple-600 text-white px-4 py-2 rounded">{loading ? 'Logging in...' : 'Login'}</button>
              <div className="mt-4 text-center">
                <a href="./index.html" target="_blank" className="text-purple-600"><i className="fas fa-eye mr-1"></i>View Portfolio</a>
              </div>
            </div>
          </div>
        );
      }

      const tabs = [
        { id: 'profile', label: 'Profile', icon: 'fas fa-user' },
        { id: 'skills', label: 'Skills', icon: 'fas fa-code' },
        { id: 'projects', label: 'Projects', icon: 'fas fa-briefcase' },
        { id: 'experience', label: 'Experience', icon: 'fas fa-graduation-cap' },
        { id: 'certificates', label: 'Certificates', icon: 'fas fa-award' }
      ];

      function ProfileForm({ profile }) {
        const [formData, setFormData] = useState(profile || {});
        useEffect(() => setFormData(profile || {}), [profile]);

        function handleSave() {
          // no profile image fields at all
          saveItem('profile', formData);
        }

        return (
          <div className="space-y-6">
            <div>
              <h2 className="text-lg font-semibold">Basic Info</h2>
              <p className="text-sm text-gray-500">Profile image removed — only textual info required.</p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Name</label>
                <input className="w-full px-3 py-2 border rounded" value={formData.name || ''} onChange={e => setFormData({ ...formData, name: e.target.value })} />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Title</label>
                <input className="w-full px-3 py-2 border rounded" value={formData.title || ''} onChange={e => setFormData({ ...formData, title: e.target.value })} />
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea className="w-full px-3 py-2 border rounded" rows="4" value={formData.description || ''} onChange={e => setFormData({ ...formData, description: e.target.value })} />
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Email</label>
                <input className="w-full px-3 py-2 border rounded" value={formData.email || ''} onChange={e => setFormData({ ...formData, email: e.target.value })} />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                <input className="w-full px-3 py-2 border rounded" value={formData.phone || ''} onChange={e => setFormData({ ...formData, phone: e.target.value })} />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Location</label>
                <input className="w-full px-3 py-2 border rounded" value={formData.location || ''} onChange={e => setFormData({ ...formData, location: e.target.value })} />
              </div>
            </div>

            <div>
              <h3 className="text-md font-medium mb-2">Social Links</h3>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div>
                  <label className="block text-sm text-gray-700 mb-1">LinkedIn</label>
                  <input className="w-full px-3 py-2 border rounded" value={formData.socialLinks?.linkedin || ''} onChange={e => setFormData({ ...formData, socialLinks: { ...(formData.socialLinks || {}), linkedin: e.target.value } })} />
                </div>
                <div>
                  <label className="block text-sm text-gray-700 mb-1">GitHub</label>
                  <input className="w-full px-3 py-2 border rounded" value={formData.socialLinks?.github || ''} onChange={e => setFormData({ ...formData, socialLinks: { ...(formData.socialLinks || {}), github: e.target.value } })} />
                </div>
                <div>
                  <label className="block text-sm text-gray-700 mb-1">Instagram</label>
                  <input className="w-full px-3 py-2 border rounded" value={formData.socialLinks?.instagram || ''} onChange={e => setFormData({ ...formData, socialLinks: { ...(formData.socialLinks || {}), instagram: e.target.value } })} />
                </div>
              </div>
            </div>

            <button onClick={handleSave} className="bg-purple-600 text-white px-4 py-2 rounded">
              <i className="fas fa-save mr-2"></i>Save Profile
            </button>
          </div>
        );
      }

      function ItemModal({ type, item, onClose, onSave }) {
        const [formData, setFormData] = useState(item || {});
        useEffect(() => setFormData(item || {}), [item]);

        function handleSave() {
          // Normalize fields where necessary: keep backend-compatible shape
          // For icon store as an object, but we won't break existing backend by leaving old simple 'icon' if previously used.
          onSave(formData);
        }

        function renderFields() {
          switch (type) {
            case 'skills':
              return (
                <>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Skill Name</label>
                    <input className="w-full px-3 py-2 border rounded" value={formData.name || ''} onChange={e => setFormData({ ...formData, name: e.target.value })} />
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Proficiency (%)</label>
                      <input type="number" min="0" max="100" className="w-full px-3 py-2 border rounded" value={formData.percentage || 0} onChange={e => setFormData({ ...formData, percentage: parseInt(e.target.value || 0) })} />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Category</label>
                      <select className="w-full px-3 py-2 border rounded" value={formData.category || ''} onChange={e => setFormData({ ...formData, category: e.target.value })}>
                        <option value=''>Select category</option>
                        <option value="frontend">Frontend</option>
                        <option value="backend">Backend</option>
                        <option value="mobile">Mobile</option>
                        <option value="devops">DevOps</option>
                        <option value="data">Data</option>
                      </select>
                    </div>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    <IconSelect label="Choose Icon" value={formData.icon} onChange={(v) => setFormData({ ...formData, icon: v })} />
                    <ColorSelect label="Icon / Accent Color" value={formData.color || ''} onChange={(v) => setFormData({ ...formData, color: v })} />
                  </div>

                  <div className="mt-3">
                    <PresetSelect label="Visual preset (optional)" value={formData.classPreset} onChange={(v) => setFormData({ ...formData, classPreset: v })} options={classPresets} />
                  </div>
                </>
              );

            case 'projects':
              return (
                <>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Project Title</label>
                    <input className="w-full px-3 py-2 border rounded" value={formData.title || ''} onChange={e => setFormData({ ...formData, title: e.target.value })} />
                  </div>

                  <div className="mt-3">
                    <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea rows="3" className="w-full px-3 py-2 border rounded" value={formData.description || ''} onChange={e => setFormData({ ...formData, description: e.target.value })}></textarea>
                  </div>

                  <div className="mt-3">
                    <MultiSelectChips label="Technologies Used" values={formData.technologies || []} onChange={(v) => setFormData({ ...formData, technologies: v })} suggestions={defaultTechSuggestions} />
                  </div>

                  <div className="mt-3">
                    <label className="block text-sm font-medium text-gray-700 mb-2">Features (one per line)</label>
                    <textarea rows="3" className="w-full px-3 py-2 border rounded" value={(formData.features || []).join('\n')} onChange={e => setFormData({ ...formData, features: e.target.value.split('\n').map(l => l.trim()).filter(l => l) })}></textarea>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Category</label>
                      <select className="w-full px-3 py-2 border rounded" value={formData.category || ''} onChange={e => setFormData({ ...formData, category: e.target.value })}>
                        <option value=''>General</option>
                        <option value="web">Web</option>
                        <option value="mobile">Mobile</option>
                        <option value="ml">Machine Learning</option>
                        <option value="automation">Automation</option>
                      </select>
                    </div>

                    <div>
                      <IconSelect label="Project Icon" value={formData.icon} onChange={(v) => setFormData({ ...formData, icon: v })} />
                    </div>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                    <PresetSelect label="Gradient Preset" value={formData.gradient} onChange={(v) => setFormData({ ...formData, gradient: v })} options={gradientPresets} />
                    <PresetSelect label="Class Preset (visual)" value={formData.classPreset} onChange={(v) => setFormData({ ...formData, classPreset: v })} options={classPresets} />
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Project URL</label>
                      <input type="url" className="w-full px-3 py-2 border rounded" value={formData.projectUrl || ''} onChange={e => setFormData({ ...formData, projectUrl: e.target.value })} />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">GitHub URL</label>
                      <input type="url" className="w-full px-3 py-2 border rounded" value={formData.githubUrl || ''} onChange={e => setFormData({ ...formData, githubUrl: e.target.value })} />
                    </div>
                  </div>
                </>
              );

            case 'experience':
              return (
                <>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Job Title / Degree</label>
                    <input className="w-full px-3 py-2 border rounded" value={formData.title || ''} onChange={e => setFormData({ ...formData, title: e.target.value })} />
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Company / Institution</label>
                      <input className="w-full px-3 py-2 border rounded" value={formData.company || ''} onChange={e => setFormData({ ...formData, company: e.target.value })} />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Location</label>
                      <input className="w-full px-3 py-2 border rounded" value={formData.location || ''} onChange={e => setFormData({ ...formData, location: e.target.value })} />
                    </div>
                  </div>

                  <div className="grid grid-cols-2 gap-4 mt-3">
                    <input className="px-3 py-2 border rounded" placeholder="Start (e.g., Jan 2023)" value={formData.startDate || ''} onChange={e => setFormData({ ...formData, startDate: e.target.value })} />
                    <input className="px-3 py-2 border rounded" placeholder="End (leave empty if current)" value={formData.endDate || ''} onChange={e => setFormData({ ...formData, endDate: e.target.value, current: !e.target.value })} />
                  </div>

                  <div className="mt-3">
                    <label className="flex items-center gap-2"><input type="checkbox" checked={!!formData.current} onChange={e => setFormData({ ...formData, current: e.target.checked, endDate: e.target.checked ? '' : formData.endDate })} /> Currently working/studying here</label>
                  </div>

                  <div className="mt-3">
                    <label className="block text-sm font-medium text-gray-700 mb-2">Description (one point per line)</label>
                    <textarea rows="4" className="w-full px-3 py-2 border rounded" value={(formData.description || []).join('\n')} onChange={e => setFormData({ ...formData, description: e.target.value.split('\n').map(x => x.trim()).filter(Boolean) })}></textarea>
                  </div>

                  <div className="mt-3">
                    <label className="block text-sm font-medium text-gray-700 mb-2">Type</label>
                    <select className="w-full px-3 py-2 border rounded" value={formData.type || 'experience'} onChange={e => setFormData({ ...formData, type: e.target.value })}>
                      <option value="experience">Work Experience</option>
                      <option value="education">Education</option>
                    </select>
                  </div>
                </>
              );

            case 'certificates':
              return (
                <>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Certificate Title</label>
                    <input className="w-full px-3 py-2 border rounded" value={formData.title || ''} onChange={e => setFormData({ ...formData, title: e.target.value })} />
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Issuer / Platform</label>
                      <input className="w-full px-3 py-2 border rounded" value={formData.issuer || ''} onChange={e => setFormData({ ...formData, issuer: e.target.value })} />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Date Obtained</label>
                      <input className="w-full px-3 py-2 border rounded" value={formData.date || ''} onChange={e => setFormData({ ...formData, date: e.target.value })} />
                    </div>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                    <IconSelect label="Certificate Icon" value={formData.icon} onChange={(v) => setFormData({ ...formData, icon: v })} />
                    <ColorSelect label="Accent Color" value={formData.color || ''} onChange={(v) => setFormData({ ...formData, color: v })} />
                  </div>

                  <div className="mt-3">
                    <label className="block text-sm font-medium text-gray-700 mb-2">Certificate URL (optional)</label>
                    <input type="url" className="w-full px-3 py-2 border rounded" value={formData.url || ''} onChange={e => setFormData({ ...formData, url: e.target.value })} />
                  </div>
                </>
              );

            default:
              return null;
          }
        }

        return (
          <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-lg max-w-2xl w-full p-6 max-h-[90vh] overflow-auto">
              <div className="flex justify-between items-center mb-4">
                <h3 className="text-lg font-semibold">{item ? 'Edit' : 'Add'} {type.slice(0, -1)}</h3>
                <button onClick={onClose} className="text-gray-500"><i className="fas fa-times"></i></button>
              </div>

              <div className="space-y-4">
                {renderFields()}
              </div>

              <div className="flex gap-2 mt-6">
                <button onClick={handleSave} className="bg-purple-600 text-white px-4 py-2 rounded flex-1"><i className="fas fa-save mr-2"></i>Save</button>
                <button onClick={onClose} className="bg-gray-200 px-4 py-2 rounded">Cancel</button>
              </div>
            </div>
          </div>
        );
      }

      function DataTable({ type, items, onEdit, onDelete, onAdd }) {
        function getHeaders() {
          switch (type) {
            case 'skills': return ['Name', 'Category', 'Percentage', 'Actions'];
            case 'projects': return ['Title', 'Category', 'Technologies', 'Actions'];
            case 'experience': return ['Title', 'Company', 'Type', 'Date', 'Actions'];
            case 'certificates': return ['Title', 'Issuer', 'Date', 'Actions'];
            default: return [];
          }
        }
        function rowCells(item) {
          switch (type) {
            case 'skills':
              return [item.name, item.category, `${item.percentage || 0}%`];
            case 'projects':
              return [item.title, item.category || 'General', (item.technologies || []).slice(0,3).join(', ') + ((item.technologies || []).length > 3 ? '...' : '')];
            case 'experience':
              return [item.title, item.company, item.type || 'experience', `${item.startDate || ''} - ${item.endDate || 'Present'}`];
            case 'certificates':
              return [item.title, item.issuer, item.date || 'N/A'];
            default:
              return [];
          }
        }

        return (
          <div>
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-2xl font-bold capitalize">{type}</h2>
              <button onClick={onAdd} className="bg-purple-600 text-white px-4 py-2 rounded">
                <i className="fas fa-plus mr-2"></i>Add {type.slice(0,-1)}
              </button>
            </div>

            <div className="bg-white rounded shadow">
              <table className="min-w-full divide-y divide-gray-200">
                <thead className="bg-gray-50">
                  <tr>
                    {getHeaders().map(h => <th key={h} className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{h}</th>)}
                    <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {items.map(it => (
                    <tr key={it._id || Math.random()}>
                      {rowCells(it).map((c, i) => <td key={i} className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{c}</td>)}
                      <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button onClick={() => onEdit(it)} className="text-indigo-600 hover:text-indigo-900 mr-4"><i className="fas fa-edit"></i></button>
                        <button onClick={() => onDelete(it._id)} className="text-red-600 hover:text-red-900"><i className="fas fa-trash"></i></button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>

              {items.length === 0 && <div className="p-6 text-center text-gray-500">No {type} found. Click "Add {type.slice(0,-1)}" to create one.</div>}
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen">
          <div className="bg-white shadow-sm border-b">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div className="flex justify-between items-center py-4">
                <h1 className="text-2xl font-bold">Portfolio Admin Panel</h1>
                <div className="flex items-center gap-4">
                  <a href="./index.html" target="_blank" className="text-purple-600 hover:text-purple-700 flex items-center"><i className="fas fa-eye mr-1"></i>View Portfolio</a>
                  <button onClick={logout} className="bg-red-600 text-white px-4 py-2 rounded"><i className="fas fa-sign-out-alt mr-2"></i>Logout</button>
                </div>
              </div>
            </div>
          </div>

          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div className="border-b border-gray-200 mb-6">
              <nav className="-mb-px flex space-x-8">
                {tabs.map(t => (
                  <button key={t.id} onClick={() => setActiveTab(t.id)} className={`${activeTab === t.id ? 'border-purple-500 text-purple-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm flex items-center`}>
                    <i className={`${t.icon} mr-2`}></i>{t.label}
                  </button>
                ))}
              </nav>
            </div>

            <div className="bg-white rounded shadow p-6">
              {activeTab === 'profile' && <ProfileForm profile={data.profile} />}

              {activeTab !== 'profile' && (
                <DataTable
                  type={activeTab}
                  items={data[activeTab] || []}
                  onEdit={(it) => { setEditingItem(it); setShowModal(true); }}
                  onDelete={(id) => deleteItem(activeTab, id)}
                  onAdd={() => { setEditingItem(null); setShowModal(true); }}
                />
              )}
            </div>

            {showModal && <ItemModal type={activeTab} item={editingItem} onClose={() => { setShowModal(false); setEditingItem(null); }} onSave={(it) => saveItem(activeTab, it)} />}
          </div>
        </div>
      );
    }

    ReactDOM.render(React.createElement(AdminPanel), document.getElementById('root'));
  </script>
</body>
</html>
